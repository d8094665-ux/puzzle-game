<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–°–æ–±–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É</title>

<style>
body {
  margin: 0;
  padding: 16px;
  background: #1f1f1f;
  color: #fff;
  font-family: Arial, sans-serif;
  user-select: none;
}

h1 {
  text-align: center;
  font-size: 20px;
}

#board {
  max-width: 360px;
  margin: 20px auto;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
}

.cell {
  width: 100%;
  padding-top: 100%;
  position: relative;
  background: #2b2b2b;
  border-radius: 8px;
  overflow: hidden;
}

.piece {
  position: absolute;
  inset: 0;
  background-size: 300% 300%;
  touch-action: none;
}

.dragging {
  opacity: 0.8;
  transform: scale(1.05);
  z-index: 1000;
}

#bonus {
  display: none;
  text-align: center;
  margin-top: 20px;
}

button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  margin-top: 12px;
}

.back-btn {
  background: #2b2b2b;
  color: #fff;
  border: 1px solid #444;
}
</style>
</head>

<body>

<h1>üß© –°–æ–±–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É ‚Äî –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å</h1>

<div id="board"></div>

<div id="bonus">
  <h2>üéâ –û—Ç–ª–∏—á–Ω–æ!</h2>
  <p id="bonusText">–í—ã —Å–æ–±—Ä–∞–ª–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É –∏ –ø–æ–ª—É—á–∏–ª–∏ –±–æ–Ω—É—Å</p>
  <button class="back-btn" id="backToCatalog">
    üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º
  </button>
</div>

<script>
const images = [
  "./images/apt1.jpg",
  "./images/apt2.jpg"
];

const size = 3;
const board = document.getElementById("board");
const bonus = document.getElementById("bonus");
const bonusText = document.getElementById("bonusText");
const image = images[Math.floor(Math.random() * images.length)];

let activePiece = null;
let startCell = null;

// –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
let positions = [...Array(size * size).keys()];
positions.sort(() => Math.random() - 0.5);

// —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è
positions.forEach((correctPos) => {
  const cell = document.createElement("div");
  cell.className = "cell";

  const piece = document.createElement("div");
  piece.className = "piece";
  piece.dataset.correct = correctPos;

  const x = correctPos % size;
  const y = Math.floor(correctPos / size);

  piece.style.backgroundImage = `url('${image}')`;
  piece.style.backgroundPosition = `${x * -100}% ${y * -100}%`;

  piece.addEventListener("pointerdown", startDrag);

  cell.appendChild(piece);
  board.appendChild(cell);
});

function startDrag(e) {
  activePiece = e.target;
  startCell = activePiece.parentElement;

  activePiece.classList.add("dragging");

  document.addEventListener("pointermove", moveDrag);
  document.addEventListener("pointerup", endDrag);
}

function moveDrag(e) {
  activePiece.style.transform =
    `translate(${e.movementX}px, ${e.movementY}px) scale(1.05)`;
}

function endDrag(e) {
  activePiece.classList.remove("dragging");
  activePiece.style.transform = "";

  const target = document.elementFromPoint(e.clientX, e.clientY);
  const targetCell = target?.closest(".cell");

  if (targetCell && targetCell !== startCell) {
    const targetPiece = targetCell.firstElementChild;
    targetCell.appendChild(activePiece);
    startCell.appendChild(targetPiece);
    checkWin();
  }

  document.removeEventListener("pointermove", moveDrag);
  document.removeEventListener("pointerup", endDrag);

  activePiece = null;
  startCell = null;
}

function checkWin() {
  const cells = document.querySelectorAll(".cell");
  let correct = 0;

  cells.forEach((cell, index) => {
    const piece = cell.firstElementChild;
    if (piece && Number(piece.dataset.correct) === index) {
      correct++;
    }
  });

  if (correct === size * size) {
    bonusText.textContent = "–í—ã —Å–æ–±—Ä–∞–ª–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É! –í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥: SVETLI5 ‚Äî —Å–∫–∏–¥–∫–∞ 5%";
    bonus.style.display = "block";
  }
}

// –∫–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
document.getElementById("backToCatalog").onclick = () => {
  const link = "https://t.me/svetliidom_booking_bot/realty";
  if (window.Telegram && Telegram.WebApp) {
    Telegram.WebApp.openTelegramLink(link);
  } else {
    location.href = link;
  }
};
</script>

</body>
</html>
