<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–°–æ–±–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É</title>

<style>
body {
  margin: 0;
  padding: 16px;
  background: #1f1f1f;
  color: #ffffff;
  font-family: Arial, sans-serif;
}

h1 {
  text-align: center;
  font-size: 20px;
  margin-bottom: 10px;
}

#game {
  max-width: 360px;
  margin: 0 auto;
}

#board {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  margin-top: 12px;
}

.cell {
  width: 100%;
  aspect-ratio: 1 / 1;
  background: #2e2e2e;
  border-radius: 8px;
  overflow: hidden;
}

.piece {
  width: 100%;
  height: 100%;
  background-size: 300% 300%;
  cursor: grab;
}

#bonus {
  display: none;
  text-align: center;
  margin-top: 20px;
}

button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  margin-top: 12px;
}

.bonus-btn {
  background: #00c853;
  color: #fff;
}

.back-btn {
  background: #2b2b2b;
  color: #fff;
  border: 1px solid #444;
}
</style>
</head>

<body>
<div id="game">
  <h1>üß© –°–æ–±–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É ‚Äî –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å</h1>

  <div id="board"></div>

  <div id="bonus">
    <h2>üéâ –ì–æ—Ç–æ–≤–æ!</h2>
    <p>–í–∞—à –±–æ–Ω—É—Å: <b>—Å–∫–∏–¥–∫–∞ –∏–ª–∏ —Ä–∞–Ω–Ω–∏–π –∑–∞–µ–∑–¥</b></p>

    <button class="bonus-btn" id="backToCatalog">
      üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º
    </button>
  </div>
</div>

<script>
// === –ù–ê–°–¢–†–û–ô–ö–ò ===
const images = [
  "images/apt1.jpg",
  "images/apt2.jpg",
  "images/apt3.jpg"
];

const size = 3;
const board = document.getElementById("board");
const bonus = document.getElementById("bonus");

const image = images[Math.floor(Math.random() * images.length)];
let dragged = null;
let placed = 0;

// === –°–û–ó–î–ê–ù–ò–ï –ü–ê–ó–õ–ê ===
const positions = [];

for (let i = 0; i < size * size; i++) {
  positions.push(i);
}

positions.sort(() => Math.random() - 0.5);

for (let i = 0; i < size * size; i++) {
  const cell = document.createElement("div");
  cell.className = "cell";
  cell.dataset.index = i;

  cell.addEventListener("dragover", e => e.preventDefault());

  cell.addEventListener("drop", () => {
    if (!dragged) return;
    if (cell.firstChild) return;

    if (dragged.dataset.correct == cell.dataset.index) {
      cell.appendChild(dragged);
      dragged.draggable = false;
      placed++;

      if (placed === size * size) {
        setTimeout(showBonus, 300);
      }
    }
  });

  board.appendChild(cell);
}

positions.forEach(pos => {
  const piece = document.createElement("div");
  piece.className = "piece";
  piece.draggable = true;
  piece.dataset.correct = pos;

  const x = pos % size;
  const y = Math.floor(pos / size);

  piece.style.backgroundImage = `url(${image})`;
  piece.style.backgroundPosition = `${x * -100}% ${y * -100}%`;

  piece.addEventListener("dragstart", () => dragged = piece);
  piece.addEventListener("dragend", () => dragged = null);

  board.appendChild(piece);
});

// === –ü–û–ö–ê–ó –ë–û–ù–£–°–ê ===
function showBonus() {
  bonus.style.display = "block";
}

// === –ö–ù–û–ü–ö–ê –í –ö–ê–¢–ê–õ–û–ì ===
document.getElementById("backToCatalog").onclick = function () {
  if (window.Telegram && Telegram.WebApp) {
    Telegram.WebApp.openTelegramLink(
      "https://t.me/svetliidom_booking_bot/realty"
    );
  } else {
    window.location.href =
      "https://t.me/svetliidom_booking_bot/realty";
  }
};
</script>
</body>
</html>
