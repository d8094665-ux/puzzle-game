<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–°–æ–±–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É</title>

<style>
body {
  margin: 0;
  padding: 16px;
  background: #1f1f1f;
  color: #fff;
  font-family: Arial, sans-serif;
}

h1 {
  text-align: center;
  font-size: 20px;
}

#board {
  max-width: 360px;
  margin: 20px auto;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
}

.cell {
  aspect-ratio: 1 / 1;
  background: #2b2b2b;
  border-radius: 8px;
  overflow: hidden;
}

.piece {
  width: 100%;
  height: 100%;
  background-size: 300% 300%;
  cursor: grab;
}

#bonus {
  display: none;
  text-align: center;
}

button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  margin-top: 12px;
}

.back-btn {
  background: #2b2b2b;
  color: #fff;
  border: 1px solid #444;
}
</style>
</head>

<body>

<h1>üß© –°–æ–±–µ—Ä–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É ‚Äî –ø–æ–ª—É—á–∏ –±–æ–Ω—É—Å</h1>

<div id="board"></div>

<div id="bonus">
  <h2>üéâ –û—Ç–ª–∏—á–Ω–æ!</h2>
  <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É –∏ –ø–æ–ª—É—á–∏–ª–∏ –±–æ–Ω—É—Å</p>
  <button class="back-btn" id="backToCatalog">
    üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º
  </button>
</div>

<script>
const images = [
  "images/apt1.jpg",
  "images/apt2.jpg"
];

const size = 3;
const board = document.getElementById("board");
const bonus = document.getElementById("bonus");

const image = images[Math.floor(Math.random() * images.length)];
let draggedPiece = null;

// –º–∞—Å—Å–∏–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
let positions = [...Array(size * size).keys()];
positions.sort(() => Math.random() - 0.5);

// —Å–æ–∑–¥–∞—ë–º –ø–æ–ª–µ
positions.forEach((correctPos, cellIndex) => {
  const cell = document.createElement("div");
  cell.className = "cell";
  cell.dataset.index = cellIndex;

  const piece = document.createElement("div");
  piece.className = "piece";
  piece.draggable = true;

  piece.dataset.correct = correctPos;

  const x = correctPos % size;
  const y = Math.floor(correctPos / size);

  piece.style.backgroundImage = `url(${image})`;
  piece.style.backgroundPosition = `${x * -100}% ${y * -100}%`;

  piece.addEventListener("dragstart", () => {
    draggedPiece = piece;
  });

  piece.addEventListener("dragend", () => {
    draggedPiece = null;
  });

  cell.addEventListener("dragover", e => e.preventDefault());

  cell.addEventListener("drop", () => {
    if (!draggedPiece) return;

    const fromCell = draggedPiece.parentElement;
    if (fromCell === cell) return;

    const targetPiece = cell.firstElementChild;

    cell.appendChild(draggedPiece);
    fromCell.appendChild(targetPiece);

    checkWin();
  });

  cell.appendChild(piece);
  board.appendChild(cell);
});

// –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
function checkWin() {
  const cells = document.querySelectorAll(".cell");
  let correct = 0;

  cells.forEach((cell, index) => {
    const piece = cell.firstElementChild;
    if (piece && Number(piece.dataset.correct) === index) {
      correct++;
    }
  });

  if (correct === size * size) {
    bonus.style.display = "block";
  }
}

// –∫–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞
document.getElementById("backToCatalog").onclick = () => {
  const link = "https://t.me/svetliidom_booking_bot/realty";

  if (window.Telegram && Telegram.WebApp) {
    Telegram.WebApp.openTelegramLink(link);
  } else {
    window.location.href = link;
  }
};
</script>

</body>
</html>
